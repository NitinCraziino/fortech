import{r as l,u as V,h as J,i as G,k as q,m as Q,n as W,j as e,T as X,o as Y,p as k,q as Z,s as R,t as ee,v as T,C as M,B as m,P as se,S as te,D as ae,e as B,b as I,d as F,w as ne,x as ie,y as le,z as ce,A as re,E as oe,I as O,F as de,G as ue,H as D,J as E,K as ge,L as he,M as me,N as xe,O as fe}from"./index-V67Iib8C.js";import{C as z,E as je,P as pe}from"./Pagination-CWW75XFJ.js";import"./select-CsmTK3g7.js";function Ce(i){var P;const[p,x]=l.useState([]),[S,f]=l.useState([]),[w,d]=l.useState({}),[C,h]=l.useState({}),j=V(),u=()=>[{id:"select-col",header:()=>e.jsx(M,{checked:i.isAllSelected,onCheckedChange:s=>i.selectAll(s)}),cell:({row:s})=>e.jsx(M,{onCheckedChange:t=>i.setSelectedProducts(t,s.original),checked:!!i.selectedProducts.find(t=>t._id===s.original._id)})},{accessorKey:"name",header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"flex items-center gap-2",children:["Name",e.jsx(z,{className:"h-4 w-4"})]}),filterFn:"includesString",cell:({row:s})=>e.jsxs("div",{className:"flex items-center gap-3 ms-4",children:[s.original.image&&s.original.image!==""&&e.jsx("img",{src:`https://www.naisorders.com${s.original.image}`,alt:"product",className:"rounded-full h-8 w-8"}),e.jsx("span",{children:s.getValue("name")})]})},{accessorKey:"partNo",header:({column:s})=>e.jsxs(m,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),className:"flex items-center gap-2",children:["Part No.",e.jsx(z,{className:"h-4 w-4"})]}),filterFn:"includesString",cell:({row:s})=>e.jsx("div",{className:"flex items-center gap-3 ms-4",children:e.jsx("span",{children:s.getValue("partNo")})})},{accessorKey:"unitPrice",header:"Unit Price",cell:({row:s})=>{const{unitPrice:t,customerPrice:a}=s.original;return e.jsxs("div",{children:["$ ",i.isAdmin?t:a]})},filterFn:"inNumberRange"},{accessorKey:"unit",header:"Unit of Measure",cell:({row:s})=>e.jsx("div",{children:s.getValue("unit")}),filterFn:"includesString"},{accessorKey:"description",header:"Description",cell:({row:s})=>e.jsx("div",{className:"max-w-[300px] truncate",children:s.getValue("description")}),filterFn:"includesString"},{id:"actions",header:()=>e.jsx("div",{className:"text-center",children:"Actions"}),enableHiding:!1,cell:({row:s})=>{const t=s.original,a=()=>{console.log("Deleting product:",t._id)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(m,{onClick:()=>j(`/view-product/${t._id}`),variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(je,{className:"h-4 w-4"})}),i.isAdmin&&e.jsxs(l.Fragment,{children:[e.jsx(m,{onClick:()=>j(`/edit-product/${t._id}`),variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(se,{className:"h-4 w-4"})}),e.jsx(te,{onCheckedChange:n=>i.updateStatus(n,t._id),checked:t.active})]})]}),e.jsx(ae,{open:!1,onOpenChange:n=>console.log(n),onConfirm:a})]})}}],g=J({data:i.products,columns:u(),onSortingChange:x,onColumnFiltersChange:f,getCoreRowModel:G(),getPaginationRowModel:q(),getSortedRowModel:Q(),getFilteredRowModel:W(),onColumnVisibilityChange:d,onRowSelectionChange:h,globalFilterFn:(o,s,t)=>{const a=o.getValue(s);return typeof a=="string"?a.toLowerCase().includes(t.toLowerCase()):typeof a=="number"?a.toString().includes(t):!1},onGlobalFilterChange:i.setFilterText,state:{globalFilter:i.filterText,sorting:p,columnFilters:S,columnVisibility:w,rowSelection:C,pagination:{pageIndex:i.pageIndex-1,pageSize:i.pageSize}}});return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"rounded-lg border",children:e.jsxs(X,{children:[e.jsx(Y,{children:g.getHeaderGroups().map(o=>e.jsx(k,{children:o.headers.map(s=>e.jsx(Z,{children:s.isPlaceholder?null:R(s.column.columnDef.header,s.getContext())},s.id))},o.id))}),e.jsx(ee,{children:(P=g.getRowModel().rows)!=null&&P.length?g.getRowModel().rows.map(o=>e.jsx(k,{"data-state":o.getIsSelected()&&"selected",children:o.getVisibleCells().map(s=>e.jsx(T,{children:R(s.column.columnDef.cell,s.getContext())},s.id))},o.id)):e.jsx(k,{children:e.jsx(T,{colSpan:u().length,className:"h-24 text-center",children:"No results."})})})]})})})}const Se=({open:i,onOpenChange:p,selectedProducts:x})=>{const{success:S,errorToast:f}=B(),w=I(),[d,C]=l.useState([]),[h,j]=l.useState({}),{customers:u,loading:g}=F(t=>t.customer);l.useEffect(()=>{i&&w(ne({}))},[i]);const P=t=>{if(d.includes(t)){C(d.filter(n=>n!==t));const a={...h};delete a[t],j(a)}else{C([...d,t]);const a={...h};a[t]={},x.forEach(n=>{a[t][n._id]=n.unitPrice}),j(a)}},o=(t,a,n)=>{const r={...h};r[t]||(r[t]={}),r[t][a]=n,j(r)},s=async()=>{if(d.length===0){f("Please select at least one customer");return}if(d.some(a=>x.some(n=>{var b;const r=(b=h[a])==null?void 0:b[n._id];return!r||r<=0}))){f("Please set valid prices for all products and customers");return}try{const a=[];d.forEach(n=>{x.forEach(r=>{a.push({customerId:n,productId:r._id,price:h[n][r._id]})})}),await w(ue({assignments:a})).unwrap(),S("Products assigned successfully"),p(!1)}catch{f("Failed to assign products")}};return e.jsx(ie,{open:i,onOpenChange:p,children:e.jsxs(le,{className:"sm:max-w-[600px]",children:[e.jsx(ce,{children:e.jsx(re,{children:"Assign Products to Customers"})}),e.jsx("div",{className:"grid gap-4 py-4",children:e.jsxs("div",{className:"grid gap-2",children:[e.jsx(oe,{children:"Select Customers and Set Prices"}),e.jsx("div",{className:"max-h-[400px] overflow-y-auto border rounded-md p-2",children:u.map(t=>e.jsxs("div",{className:"mb-4 border-b pb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("input",{type:"checkbox",id:t._id,checked:d.includes(t._id),onChange:()=>P(t._id)}),e.jsx("label",{htmlFor:t._id,className:"font-medium",children:t.name})]}),d.includes(t._id)&&e.jsx("div",{className:"ml-4 grid gap-2",children:x.map(a=>{var n;return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 flex-1",children:[a.image&&e.jsx("img",{src:`https://www.naisorders.com${a.image}`,alt:a.name,className:"w-8 h-8 object-contain"}),e.jsx("span",{children:a.name})]}),e.jsx(O,{type:"number",className:"w-24",value:(n=h[t._id])==null?void 0:n[a._id],onChange:r=>o(t._id,a._id,Number(r.target.value)),placeholder:"Price"})]},a._id)})})]},t._id))})]})}),e.jsxs(de,{children:[e.jsx(m,{variant:"outline",onClick:()=>p(!1),children:"Cancel"}),e.jsx(m,{onClick:s,disabled:g,children:g?"Assigning...":"Assign Products"})]})]})})},ve=()=>{const{success:i,errorToast:p}=B(),[x,S]=l.useState(1),[f,w]=l.useState(10),[d,C]=l.useState(""),[h,j]=l.useState(!1),[u,g]=l.useState([]),[P,o]=l.useState(null),s=I(),t=V(),a=l.useRef(null),{products:n,error:r,loading:b}=F(c=>c.product);l.useEffect(()=>{r&&p(r)},[r]);const{user:v}=F(c=>c.auth);l.useEffect(()=>{v.admin?s(D({})):s(E({}))},[v]);const U=async(c,N)=>{try{await s(xe({productId:N,active:c})).unwrap(),i("Status updated.")}catch(y){console.log(y)}},H=async c=>{if(c.target.files){o(c.target.files[0]);try{await s(fe({file:c.target.files[0]})).unwrap(),o(null),v.admin?s(D({})):s(E({})),i("Bulk update success.")}catch(N){console.log("ðŸš€ ~ handleFileChange ~ error:",N)}}},K=()=>{a.current&&a.current.click()},[L,A]=l.useState(!1);return e.jsxs("div",{className:"p-6",children:[e.jsx(ge,{show:b,fullScreen:!0}),e.jsxs("div",{className:"flex gap-6 mb-6",children:[e.jsxs("div",{className:"relative w-full",children:[e.jsx(O,{value:d,onChange:c=>C(c.target.value),type:"text",placeholder:"Search",className:"focus-visible:outline-none ps-10 !h-10"}),e.jsx("div",{className:"absolute top-1/2 -translate-y-1/2 left-5",children:e.jsx("img",{src:"icons/search.svg",alt:"search"})})]}),e.jsx("div",{children:v.admin?e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx(m,{className:"min-w-[130px]",size:"lg",children:e.jsx(he,{to:"/create-product",children:"Create Product"})}),e.jsx("input",{type:"file",accept:".csv",ref:a,onChange:H,className:"hidden",id:"imageUpload"}),e.jsx(m,{onClick:K,className:"min-w-[130px]",size:"lg",children:"Bulk Update Prices"}),u.length>0&&e.jsx(m,{onClick:()=>A(!0),className:"min-w-[130px]",size:"lg",children:"Assign to Customers"})]}):e.jsx(m,{onClick:()=>{s(me(u)),t("/create-order")},className:"px-[22px]",children:"Create Order"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{pageIndex:x,pageSize:f,isAllSelected:h,selectAll:c=>{c?(j(!0),g([...n])):(j(!1),g([]))},setSelectedProducts:(c,N)=>{if(c)g([...u,N]);else{const y=u.findIndex($=>$._id===N._id),_=JSON.parse(JSON.stringify(u));_.splice(y,1),g(_)}},selectedProducts:u,setFilterText:C,filterText:d,updateStatus:U,isAdmin:v.admin,products:n}),e.jsx(pe,{currentPage:x,totalPages:Math.ceil(n.length/f),rowsPerPage:f,onPageChange:S,onRowsPerPageChange:c=>{w(c),S(1)}})]}),e.jsx(Se,{open:L,onOpenChange:A,selectedProducts:u})]})};export{ve as default};
